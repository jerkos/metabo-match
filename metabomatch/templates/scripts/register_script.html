{% extends theme("layout.html") %}
{% from theme("macros.html") import horizontal_field %}
{% from theme("macros.html") import field_label %}
{% from theme("macros.html") import render_select_field %}
{% from theme("macros.html") import field_description %}
{% from theme("macros.html") import field_errors %}

{% block content %}

    <h3>Register Script</h3>
    <p class="help-block">Choose the right programming language to get the right coloration syntax. There is also a simple text mode.</p>
    <hr/>

    <form class="form-horizontal" role="form" method="POST">
        {{ form.hidden_tag() }}

{#        {{ render_select_field(form.software, div_class='col-md-9 col-md-offset-3', label_class='col-md-3') }}#}
        <div class="form-group row">
            <label class="control-label col-md-3">software</label>
            <div class="col-md-9">
                <select name='software' class="form-control ">
                    {% for c in form.software.choices %}
                        <option value="{{ c[0] }}"> {{ c[0] }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        {{ horizontal_field(form.title) }}

{#        {{ render_select_field(form.programming_language, div_class='col-md-9', label_class='col-md-3') }}#}
        <div class="form-group row">
            <label class="control-label col-md-3">programming language</label>
            <div class="col-md-9">
                <select id="prog_lang" name='programming_language' class="form-control ">
                    {% for c in form.pg %}
                        <option value="{{ c }}">{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        {{ horizontal_field(form.dependancies) }}

        {{ horizontal_field(form.github_gist_url) }}

        <div class="form-group row">
            <label class="control-label col-md-3">Description</label>

            <div class="col-md-9">
                <textarea name="description" class="form-control" rows="5" placeholder="Description goes here"></textarea>
            </div>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-3">Content</label>

            <div class="col-md-9">
                <textarea id="editor" name="content" class="form-control" rows="20"></textarea>
                {{ field_description(form.content) }}
                {{ field_errors(form.content) }}
            </div>

        </div>

        <div class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
                <button type="submit" class="btn btn-success">Register</button>
            </div>
        </div>
    </form>

{% endblock %}

{% block javascript %}
    {{ super() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js"></script>
    <script>

        var editor = ace.edit("editor");
        editor.getSession().setUseWorker(true);
        editor.setTheme("ace/theme/monokai");
        editor.setOptions({maxLines: 100, minLines:20});

        $('#prog_lang').change(function() {
            var selection = "";
            $( "#prog_lang option:selected" ).each(function() {
                selection += $( this ).text();
            });
            if ( selection === "Python") {
                editor.getSession().setMode("ace/mode/python");
            } else if (selection === "R") {
                editor.getSession().setMode("ace/mode/r");
            } else if (selection === "Java") {
                editor.getSession().setMode("ace/mode/java");
            } else if (selection === "Javascript") {
                editor.getSession().setMode("ace/mode/javascript");
            } else {
                console.log("text mode");
            }
        });


    </script>
{% endblock %}