{% extends theme("layout.html") %}
{% from theme('macros.html') import render_pagination %}

{% block keywords %}
    <meta name="keywords" content="omics services, metabolomics, softwares, LC-MS, workflow, peak-picking, alignment, identification, database search, statistical analysis">
    <meta name="description" content="Shows all registered softwares on Metabomatch classified by LC-MS workflow categories">
{% endblock %}

{% block content %}

    <div class="row" style="padding: 0 0 20px 0">
        <h3>Help the community</h3>
        <hr/>
        <p> <strong>You found a new software and you to share it with the community ?</strong> Do not hesitate: <a href="{{url_for('softwares.register')}}" class="btn btn-default">Register new software</a></p>

    </div>

    <div class="row">
        <h3 class="text-left">Select the best software for your needs <small>by category</small></h3>
        <hr/>
    </div>


    <div class="row">
        <div class="col-md-3">
            <a href="/softwares?category=1" class="btn btn-primary"><i class="fa fa-tag"></i> Signal Extraction</a>
        </div>
        <div class="col-md-3">
            <a href="/softwares?category=2" class="btn btn-success"><i class="fa fa-tag"></i> LC-alignment</a>
        </div>
        <div class="col-md-3">
            <a href="/softwares?category=3" class="btn btn-warning"><i class="fa fa-tag"></i> Database Search</a>
        </div>
        <div class="col-md-3">
            <a href="/softwares?category=4" class="btn btn-danger"><i class="fa fa-tag"></i> Statistical analysis</a>
        </div>
    </div>

    <div class="row" style="padding: 50px 0 50px 0;">
        <p> Or search a software name: </p>
        <form class="form-inline" role="form" action="{{url_for('softwares.index')}}" method="GET">
            <div class="form-group">
{#                <div class="col-md-8">#}
                 <input type="text" class="form-control" name="text" placeholder="Software name">
{#                </div>#}
            </div>
            <button type="submit" class="btn btn-default">Filter</button>
        </form>
    </div>

    <div class="row">
            <h3>Selected softwares</h3>
            <p class="help-block"><strong>Note:</strong><br/>Each rates and ranking are updated each day, during the night.</p>

            <hr/>
            <table class="table table-condensed">
                <thead>
                    <tr>
                        <th>Software</th>
                        <th>Programming Language</th>
                        <th>Institute</th>
                        <th>Tags</th>
                        <th>Current Rate</th>
                        {% if current_user.is_authenticated() %}
                            <th></th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for soft in softwares.items %}

                        <tr>
                            <th><a href="{{ url_for('softwares.info', name=soft.name) }}">{{ soft.name }}</a>
                                {% if not (soft.insertion_date | older_than_one_month) %}
                                    <small><label class="label label-success">new</label></small>
                                {% endif %}
                            </th>
                            <th>{{ soft.programming_language }}</th>
                            <th>{{ soft.organization }}</th>
                            <th>
                                {% set soft_tags = soft.tags| map(attribute='tag') | join(',') %}
                                {% if 'Signal Extraction' in soft_tags %}
                                    <i class="btn btn-primary fa fa-tag"></i>
                                {% endif %}
                                {% if 'LC Alignment' in soft_tags %}
                                    <i class="btn btn-success fa fa-tag"></i>
                                {% endif %}
                                {% if 'Database Search' in soft_tags %}
                                    <i class="btn btn-warning fa fa-tag"></i>
                                {% endif %}
                                {% if 'Statistical Analysis' in soft_tags %}
                                    <i class="btn btn-danger fa fa-tag"></i>
                                {% endif %}

                            </th>
                            {% if current_user.is_authenticated() %}
                                {% set rate = soft.compute_rate() %}
                                {% if rate >=70 %}
                                    <th class="text-center"><label class="label label-primary">{{ rate }}</label></th>
                                {% elif  50 <= rate < 70  %}
                                    <th class="text-center"><label class="label label-success">{{ rate }}</label></th>
                                {% elif  30 <= rate < 50  %}
                                    <th class="text-center"><label class="label label-warning">{{ rate }}</label></th>
                                {% elif  rate < 30 %}
                                    <th class="text-center"><label class="label label-danger">{{ rate }}</label></th>
                                {% endif %}
                            {% else %}
                                <th><label class="label label-default">hidden</label></th>
                            {% endif %}
                            {% if current_user.is_authenticated() and not soft.name in (current_user.softwares_used | map(attribute='name')) %}
                                <th><a class="btn btn-sm btn-default" href="{{ url_for('softwares.register_user', name=soft.name) }}">Using this software ?</a></th>
                            {% elif current_user.is_authenticated() and soft.name in (current_user.softwares_used | map(attribute='name')) %}
                                <th><a class="btn btn-sm btn-primary" href="/"><i class="fa fa-certificate"></i> software user !</a></th>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            {{ render_pagination(softwares, url_for('softwares.index')) }}
    </div>
{% endblock %}