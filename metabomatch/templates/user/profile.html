{% extends theme("layout.html") %}

{% block content %}

{% set soft_name, software_achievements = user.software_achievements() %}
{% set job_name, job_achievements = user.job_achievements() %}
{% set script_name, script_achievements = user.script_achievements() %}
{% set forum_name, forum_achievements = user.forum_achievements() %}

<ul class="breadcrumb">
    <li><a href="{{ url_for('forum.index') }}">Forum</a></li>
    <li class="active">{{ user.username }}</li>
</ul>

{% if software_achievements['name'] %}, <blockquote>{{ software_achievements['name'] }} </blockquote>{% endif %}

<table class="table table-bordered">
    {% set soft_name, software_achievements = user.software_achievements() %}
    {% set job_name, job_achievements = user.job_achievements() %}
    {% set script_name, script_achievements = user.script_achievements() %}
    {% set forum_name, forum_achievements = user.forum_achievements() %}

    <thead>
      <th><a href="{{ user.url }}">{{ user.username }}</a></th>
      <th>Info</th>
      <th>User Stats</th>
    </thead>
    <tbody>
        <tr>

          <td width="200px">
            <table class="table table-borderless">
              <tbody>
                {% if user.avatar %}
                    <tr><td><img src="{{ user.avatar }}" alt="Avatar" height="100" width="100"> </td></tr>
                {% else %}
                    <tr><td><img class='img-rounded' src="{{ user.email | gravatar }}" alt="gravatar" height="100" width="100"></td></tr>
                {% endif %}
                {% if user|is_online %}
                <tr><td><span class="label label-success">Online</span></td></tr>
                {% else %}
                <tr><td><span class="label label-default">Offline</span></td></tr>
                {% endif %}
                <tr><td><a href="{{ url_for('user.view_all_topics', username=user.username) }}">All Topics</a></td></tr>
                <tr><td><a href="{{ url_for('user.view_all_posts', username=user.username) }}">All Posts</a></td></tr>
              </tbody>
            </table>
          </td>

          <td>
            {% if user.notes %}
                {% autoescape false %}
                {{ user.notes|markup }}
                {% endautoescape %}
            {% else %}
                User has not added any notes about him.
            {% endif %}
          </td>

          <td width="250px">
            <table class="table table-borderless">
              <tbody>
                <tr>
                  <td align="right">Group:</td>
                  <td>{{ user.primary_group.name }}</td>
                </tr>
                <tr>
                  <td align="right">Joined:</td>
                  <td>{{ user.date_joined|format_date('%b %d %Y') }}</td>
                </tr>
                <tr>
                  <td align="right">Posts:</td>
                  <td>{{ user.post_count }} ({{ user.posts_per_day }} per day)</td>
                </tr>
                <tr>
                  <td align="right">Last seen:</td>
                  <td>{%- if user.lastseen -%} {{ user.lastseen|time_since }} {%- else -%} Never seen {%- endif -%}</td>
                </tr>
                <tr>
                  <td align="right">Last post:</td>
                  <td>{%- if user.last_post -%}
                      <a href="{{ user.last_post.url }}">{{ user.last_post.date_created|time_since }}</a>
                      {%- else -%}
                        Never
                      {%- endif -%}
                  </td>
                </tr>
                <tr>
                  <td align="right">Location:</td>
                  <td>{%- if user.location -%} {{ user.location }} {%- else -%} No Info {%- endif -%}</td>
                </tr>
                <tr>
                  <td align="right">Birthday:</td>
                  <td>{% if user.birthday %} {{ user.birthday|format_date('%b %d %Y') }} {% else %} No Info {% endif %} {% if user.gender %} ({{ user.gender }}) {% endif %}</td>
                </tr>
              </tbody>
            </table>
          </td>

        </tr>
    </tbody>
</table>

<p class="help-block"><strong>The following informations are visible by all users.</strong></p>

<p class="help-block">Post new softwares, new scripts and talk in our forums to get more achievements !</p>
<h3>Achievements</h3>
<hr/>
<ul class="list-group">
    {% if software_achievements %}
        <li class="list-group-item"><strong>{{ soft_name }}</strong> <em>{{ software_achievements['name'] }}</em> <badge class="badge">level {{ software_achievements['level'] }}</badge></li>
    {% endif %}
    {% if script_achievements %}
        <li class="list-group-item"><strong>{{ script_name }}</strong> <em>{{ script_achievements['name'] }}</em> <badge class="badge">level {{ script_achievements['level'] }}</badge></li>
    {% endif %}
    {% if job_achievements %}
        <li class="list-group-item"><strong>{{ job_name }}</strong> <em>{{ job_achievements['name'] }}</em> <badge class="badge">level {{ job_achievements['level'] }}</badge></li>
    {% endif %}
    {% if forum_achievements %}
        <li class="list-group-item"><strong>{{ forum_name }}</strong> <em>{{ forum_achievements['name'] }}</em> <badge class="badge">level {{ forum_achievements['level'] }}</badge></li>
    {% endif %}
</ul>

<h3 style="padding-top: 50px;">Softwares you are using to drive your metabolomic analyses</h3>
<hr/>


<ul class="list-group">
    {% for software in user.softwares_used %}
        <li class="list-group-item">{{ software.name }}............................<a href="{{ url_for('softwares.remove_user', name=software.name) }}"><i class="fa fa-trash-o"></i>Remove</a></li>
    {% else %}
        <p>You do not have prefered softwares.</p>
        <p class="alert-info">You can choose your favorites softwares on the <a href="{{ url_for('softwares.index') }}">software page</a>.</p>
    {% endfor %}
</ul>


<h3 style="padding-top: 50px;">Proposed scripts</h3>
<hr/>
    <ul class="list-group">
    {%  for script in user.scripts %}
        <li class="list-group-item"><a href="{{ url_for('scripts.info', script_id=script.id) }}"> {{ script.title }}, <strong>{{ script.software.name }}</strong></a><span class="pull-right badge">{{ script.up_votes }}</span></li>
    {% else %}
        <p>You did not proposed any scripts yet.</p>
        <p class="alert-info">You can upload a script from the register <a href="{{ url_for('scripts.index') }}">script page</a>.</p>
    {% endfor %}
    </ul>
</ul>

<h3 style="padding-top: 50px;">Job offers</h3>
<hr/>
{% if user.jobs %}

<ul class="list-group">
    {% for job in user.jobs %}
        <li><a href="{{ ulr_for('jobs.info', job_id=job.id) }}"> {{ job.name }}, {{ job.company }}</a></li>
    {% endfor %}

</ul>
{% else %}
    <p class="alert-info">Find best candidates posting your job offer on our <a href="{{ url_for('jobs.index') }}">job page</a></p>
{% endif %}
{% endblock %}
